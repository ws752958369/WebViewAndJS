webpackJsonp([20],{1273:function(t,s,i){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(s,"__esModule",{value:!0});var n=i(11),a=e(n),d=i(141),r=e(d),o=i(2175),u=e(o),l=i(634),c=e(l),y=i(633),b=e(y),p=i(632),m=e(p),h=i(65),f=i(25),g=i(151),w=e(g),x=i(1797),v=e(x);s.default={name:"subsidy-calculation",data:function(){return{deleteBtn:w.default,helpBlue:v.default,loading:!0,footerButtons:[{name:this.$t("expense-claim.key89",{cm:"保存并计算补贴"}),type:"primary",code:"ok",handle:"confirm"}],subsidyCardList:[],sourceSubsidyList:[],withCity:!0,subsidyTips:"",subsidySelection:!1}},mounted:function(){var t=this,s=this.$route.params.expenseClaimId;s&&(0,h.getSubsidyList)(s).then(function(s){t.loading=!1,200===s.status&&s.data&&(t.subsidyTips=s.data.subsidyTips||t.$t("expense-claim.key90",{cm:"补贴规则"}),t.withCity=s.data.withCity,t.analysisSubsidy(s.data))},function(t){})},deactivated:function(){this.$destroy()},methods:(0,a.default)({},(0,f.mapMutations)("expense-claim",["setNeedRefresh"]),{analysisSubsidy:function(t){this.sourceSubsidyList=t.expenseReportSubsidyViewList,this.subsidySelection=t.subsidySelection;var s=t.expenseReportSubsidyViewList,i=[];s&&s.length>0&&(s.forEach(function(t){var s=t.userDTOList,e="",n=[];s&&s.length>0&&s.forEach(function(t){e+=""===e?t.fullName:";"+t.fullName});var a=t.expenseReportSubsidyDTOS;a&&a.length>0&&a.forEach(function(t){var s=new Date(t.startDate).Format("yyyy-MM-dd"),i=new Date(t.endDate).Format("yyyy-MM-dd"),e={};t.expenseTypes.forEach(function(t){e[t.expenseTypeOID]=t.name});var a="";t.expenseTypeOIDs.forEach(function(t){a+=""===a?e[t]:","+e[t]});var d={subsidyExtendID:t.subsidyExtendID,city:null===t.cityName?"":t.cityName,datePeriod:s+" ~ "+i,subsidyTypeStr:a};n.push(d)});var d={id:t.subsidyExtendID,subsidyStartDate:new Date(t.subsidyStartDate).Format("yyyy-MM-dd"),subsidyEndDate:new Date(t.subsidyEndDate).Format("yyyy-MM-dd"),userStr:e,subsidyList:n};i.push(d)}),this.subsidyCardList=i)},menuClick:function(t){var s=this;this.loading=!0;var i=this.$route.params.expenseClaimId;(0,h.saveSubsidyV2)(i,this.sourceSubsidyList).then(function(t){s.loading=!1,200===t.status&&s.$handPlugin.toast.show(s.$t("expense-claim.key91",{cm:"重新计算补贴成功"}))}).catch(function(t){s.loading=!1,s.$handPlugin.toast.show(t.response.data.message)}).finally(function(){s.loading=!1})},swipeOutClose:function(){},swipeOutOpen:function(){},goDetail:function(t,s){var i=this.$route.params.expenseClaimId,e=this.$route.query.hasTime,n=this.$route.query.newOtherSubsidy;this.$router.push({name:"expense-travel-allowance",params:{mode:"query",subsidyCard:this.sourceSubsidyList[s],sourceSubsidyList:this.sourceSubsidyList,subsidyIndex:s},query:{expenseId:i,hasTime:e,withCity:this.withCity,newOtherSubsidy:n+"",subsidySelection:this.subsidySelection+""}})},confirmDeleteCard:function(t,s){var i=this;this.loading=!0,(0,h.deleteSingleSubsidy)(t.id).then(function(t){i.loading=!1,200===t.status&&(i.setNeedRefresh(!0),i.subsidyCardList.splice(s,1),i.sourceSubsidyList.splice(s,1))},function(t){i.loading=!1})},deleteCard:function(t,s){var i=this;if(this.subsidyCardList.length<=1)return void this.$handPlugin.toast.show(this.$t("expense-claim.key92",{cm:"报销单上至少需要保留一条差补行程！"}));this.$handPlugin.confirm.show({title:"提示",content:this.$t("expense-claim.key93",{cm:"删除行程后，将清空已添加差补，是否删除"}),leftButtonText:this.$t("common.cancel",{cm:"取消"}),rightButtonText:this.$t("common.ok",{cm:"确定"}),rightClick:function(){i.confirmDeleteCard(t,s)}})},getUtc:function(t){function s(t){return t<=9?"0"+t:""+t}var i=t.getUTCFullYear(),e=t.getUTCMonth(),n=t.getUTCDate(),a=t.getUTCHours(),d=t.getUTCMinutes(),r=t.getUTCSeconds();return e+=1,e=s(e),n=s(n),a=s(a),d=s(d),r=s(r),i+"-"+e+"-"+n+"T"+a+":"+d+":"+r+"Z"},calculateDate:function(){var t="";if(!(this.sourceSubsidyList&&this.sourceSubsidyList.length>0))return null;var s=this.sourceSubsidyList.length-1;t=this.sourceSubsidyList[s].subsidyEndDate;var i=new Date(new Date(t).getTime()+864e5),e=i.Format("yyyy/MM/dd"),n=e+" 00:00:00",a=e+" 23:59:00";return{startUtc:this.getUtc(new Date(n)),endUtc:this.getUtc(new Date(a))}},addSubsidy:function(){var t=this,s=this.$route.params.expenseClaimId,i=this.$route.query.applicantID,e=this.calculateDate();e&&(this.loading=!0,(0,h.saveTravelTimeV2)({id:null,expenseReportOID:s,startDate:e.startUtc,endDate:e.endUtc,userIDs:i+""}).then(function(s){if(t.loading=!1,200===s.status&&s.data){t.setNeedRefresh(!0),t.$handPlugin.toast.show(t.$t("expense-claim.key94",{cm:"创建差旅行程成功"}));var i=s.data;t.sourceSubsidyList.push(i),t.goDetail(i,t.sourceSubsidyList.length-1)}else t.$handPlugin.toast.show(t.$t("expense-claim.key95",{cm:"创建差旅行程失败"}))},function(){t.loading=!1,t.$handPlugin.toast.show(t.$t("expense-claim.key96",{cm:"创建差旅行程失败,请联系管理员"}))}))}}),components:{BaseLoading:r.default,subsidyCard:u.default,Swipeout:c.default,SwipeoutItem:b.default,SwipeoutButton:m.default}}},1275:function(t,s,i){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(s,"__esModule",{value:!0});var n=i(4),a=(e(n),i(141)),d=e(a);i(65);s.default={name:"subsidy-card",props:{subsidyCard:{type:[Object]}},data:function(){return{loading:!0,subsidyCardEntity:null}},mounted:function(){this.subsidyCardEntity=this.subsidyCard},methods:{},components:{BaseLoading:d.default},watch:{subsidyCard:function(t){this.subsidyCardEntity=t}}}},1367:function(t,s,i){s=t.exports=i(468)(),s.push([t.i,"\n.subsidy-calculation {\n  padding-bottom: 1px;\n  height: 100%;\n}\n.subsidy-calculation .subsidy-calculation-inner {\n    height: 100%;\n    overflow-y: auto;\n    -webkit-overflow-scrolling: touch;\n    -webkit-backface-visibility: hidden;\n    -webkit-transform: translate3d(0, 0, 0);\n    -moz-transform: translate3d(0, 0, 0);\n    transform: translate3d(0, 0, 0);\n}\n.subsidy-calculation .subsidy-calculation-inner .tips {\n      display: -webkit-box;\n      display: -webkit-flex;\n      display: -moz-box;\n      display: -ms-flexbox;\n      display: flex;\n      padding: 0.1rem 0 0.1rem 0.1rem;\n}\n.subsidy-calculation .subsidy-calculation-inner .tips .tips-img {\n        width: 0.12rem;\n        height: 0.12rem;\n        margin-top: -4px;\n}\n.subsidy-calculation .subsidy-calculation-inner .tips .tips-img img {\n          width: 0.12rem;\n          height: 0.12rem;\n}\n.subsidy-calculation .subsidy-calculation-inner .tips .tips-text {\n        height: 0.12rem;\n        font-size: 0.12rem;\n        color: #1E78C8;\n        margin-left: 0.08rem;\n}\n.subsidy-calculation .subsidy-calculation-inner .new-travel-subsidy-wrapper {\n      height: 0.68rem;\n      padding: 0.1rem;\n      -webkit-box-sizing: border-box;\n         -moz-box-sizing: border-box;\n              box-sizing: border-box;\n}\n.subsidy-calculation .subsidy-calculation-inner .new-travel-subsidy-wrapper .btn-wrapper {\n        background: white;\n        position: relative;\n        display: -webkit-box;\n        display: -webkit-flex;\n        display: -moz-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-align: center;\n        -webkit-align-items: center;\n           -moz-box-align: center;\n            -ms-flex-align: center;\n                align-items: center;\n        -webkit-box-pack: center;\n        -webkit-justify-content: center;\n           -moz-box-pack: center;\n            -ms-flex-pack: center;\n                justify-content: center;\n        height: 100%;\n        width: 100%;\n        border: 1px dashed #1E78C8;\n        -webkit-border-radius: 5px;\n           -moz-border-radius: 5px;\n                border-radius: 5px;\n}\n.subsidy-calculation .subsidy-calculation-inner .new-travel-subsidy-wrapper .btn-wrapper .text {\n          font-size: 0.15rem;\n          color: #1E78C8;\n}\n.subsidy-calculation .subsidy-calculation-inner .new-travel-subsidy-wrapper .btn-wrapper:before, .subsidy-calculation .subsidy-calculation-inner .new-travel-subsidy-wrapper .btn-wrapper:after {\n          content: '';\n          position: absolute;\n          right: 0.2rem;\n          top: 50%;\n          width: 0.12rem;\n          height: 0.01rem;\n          background: #1E78C8;\n}\n.subsidy-calculation .subsidy-calculation-inner .new-travel-subsidy-wrapper .btn-wrapper:after {\n          -webkit-transform: rotateZ(90deg);\n             -moz-transform: rotateZ(90deg);\n              -ms-transform: rotate(90deg);\n               -o-transform: rotateZ(90deg);\n                  transform: rotateZ(90deg);\n}\n.subsidy-calculation .subsidy-calculation-inner .subsidy-swipe-out .delete-button {\n      background: #F8F8F8;\n      -webkit-box-shadow: inset 1px 0 0 0 #D7DCE6;\n         -moz-box-shadow: inset 1px 0 0 0 #D7DCE6;\n              box-shadow: inset 1px 0 0 0 #D7DCE6;\n      -webkit-box-orient: vertical;\n      -webkit-box-direction: normal;\n      -webkit-flex-flow: column;\n         -moz-box-orient: vertical;\n         -moz-box-direction: normal;\n          -ms-flex-flow: column;\n              flex-flow: column;\n}\n.subsidy-calculation .subsidy-calculation-inner .subsidy-swipe-out .delete-button .delete-icon {\n        width: 0.3rem;\n        height: 0.3rem;\n}\n.subsidy-calculation .subsidy-calculation-inner .subsidy-swipe-out .delete-button .delete-label {\n        margin-top: 0.06rem;\n        line-height: 0.14rem;\n        color: #FA6478;\n}\n",""])},1472:function(t,s,i){s=t.exports=i(468)(),s.push([t.i,"\n.subsidy-card {\n  padding: 0.14rem 0.15rem 0 0.14rem;\n  background: white;\n  margin-bottom: 0.05rem;\n}\n.subsidy-card .subsidy-title .subsidy-period {\n    font-size: 0.15rem;\n    color: #0A0F1E;\n    line-height: 1;\n}\n.subsidy-card .subsidy-title .subsidy-user-list {\n    font-size: 0.12rem;\n    line-height: 1;\n    color: #505564;\n    margin-top: 0.06rem;\n    padding-bottom: 0.1rem;\n}\n.subsidy-card .subsidy-list {\n    padding: 0.1rem 0 0.04rem 0.16rem;\n}\n.subsidy-card .subsidy-list .subsidy-item {\n      position: relative;\n}\n.subsidy-card .subsidy-list .subsidy-item .pd-circle {\n        position: absolute;\n        background: #FF9C53;\n        top: 0.035rem;\n        left: -10px;\n        width: 0.06rem;\n        height: 0.06rem;\n        -webkit-border-radius: 100%;\n        -moz-border-radius: 100%;\n        border-radius: 100%;\n        margin-right: 0.03rem;\n}\n.subsidy-card .subsidy-list .subsidy-item .city-item {\n        line-height: 0.14rem;\n}\n.subsidy-card .subsidy-list .subsidy-item .city-item .city {\n          font-size: 0.14rem;\n          color: #505564;\n}\n.subsidy-card .subsidy-list .subsidy-item .city-item .date-period {\n          font-size: 0.12rem;\n          color: #505564;\n}\n.subsidy-card .subsidy-list .subsidy-item .expense-types {\n        font-size: 0.12rem;\n        color: #8C96B4;\n        letter-spacing: 0;\n        line-height: 1;\n        margin: 0.06rem 0 0.1rem 0;\n        overflow: hidden;\n        -o-text-overflow: ellipsis;\n           text-overflow: ellipsis;\n        white-space: nowrap;\n}\n",""])},1585:function(t,s,i){var e=i(1367);"string"==typeof e&&(e=[[t.i,e,""]]);i(469)(e,{});e.locals&&(t.exports=e.locals)},1690:function(t,s,i){var e=i(1472);"string"==typeof e&&(e=[[t.i,e,""]]);i(469)(e,{});e.locals&&(t.exports=e.locals)},1797:function(t,s,i){t.exports=i.p+"static/img/help-blue-flag@3x.0d539842a9.png"},181:function(t,s,i){function e(t){i(1585)}var n=i(1)(i(1273),i(1895),e,null,null);t.exports=n.exports},1895:function(t,s){t.exports={render:function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"subsidy-calculation"},[t.loading?i("base-loading",{attrs:{type:"FIXED"}}):t._e(),t._v(" "),i("div",{staticClass:"subsidy-calculation-inner"},[i("div",{staticClass:"tips"},[i("div",{staticClass:"tips-img"},[i("img",{attrs:{src:t.helpBlue}})]),t._v(" "),i("div",{staticClass:"tips-text"},[i("span",{staticClass:"text"},[t._v("\n                    "+t._s(t.subsidyTips)+"\n                ")])])]),t._v(" "),i("swipeout",{staticClass:"subsidy-swipe-out"},t._l(t.subsidyCardList,function(s,e){return i("div",{key:s.id},[i("swipeout-item",{staticClass:"invoice-swipeout-item",attrs:{distance:80,disabled:!1},on:{"on-close":t.swipeOutClose,"on-open":t.swipeOutOpen}},[i("div",{attrs:{slot:"button"},slot:"button"},[i("swipeout-button",{staticClass:"delete-button",staticStyle:{background:"#F8F8F8"},nativeOn:{click:function(i){t.deleteCard(s,e)}}},[i("img",{staticClass:"delete-icon",attrs:{src:t.deleteBtn}})])],1),t._v(" "),i("div",{attrs:{slot:"content"},slot:"content"},[i("subsidy-card",{attrs:{"subsidy-card":s},nativeOn:{click:function(i){t.goDetail(s,e)}}})],1)])],1)})),t._v(" "),t.loading?t._e():i("div",{staticClass:"new-travel-subsidy-wrapper"},[i("div",{staticClass:"btn-wrapper",on:{click:function(s){t.addSubsidy()}}},[i("span",{staticClass:"text"},[t._v("\n                "+t._s(t.$t("expense-claim.key88",{cm:"添加差旅行程"}))+"\n            ")])])])],1)],1)},staticRenderFns:[]}},2e3:function(t,s){t.exports={render:function(){var t=this,s=t.$createElement,i=t._self._c||s;return t.subsidyCardEntity&&t.subsidyCardEntity.subsidyStartDate?i("div",{staticClass:"subsidy-card"},[i("div",{staticClass:"subsidy-title"},[i("div",{staticClass:"subsidy-period"},[t._v("\n            "+t._s(t.subsidyCardEntity.subsidyStartDate)+" ~ "+t._s(t.subsidyCardEntity.subsidyEndDate)+"\n        ")]),t._v(" "),i("div",{staticClass:"subsidy-user-list",class:{"half-px-border":t.subsidyCardEntity.subsidyList&&t.subsidyCardEntity.subsidyList.length>0}},[t._v("\n            "+t._s(t.subsidyCardEntity.userStr)+"\n        ")])]),t._v(" "),t.subsidyCardEntity.subsidyList&&t.subsidyCardEntity.subsidyList.length>0?i("div",{staticClass:"subsidy-list"},t._l(t.subsidyCardEntity.subsidyList,function(s){return i("div",{staticClass:"subsidy-item"},[i("div",{staticClass:"pd-circle"},[t._v("  ")]),t._v(" "),i("div",{staticClass:"city-item"},[i("span",{staticClass:"city"},[t._v(t._s(s.city))]),t._v(" "),i("span",{staticClass:"date-period"},[t._v(t._s(s.datePeriod))])]),t._v(" "),i("div",{staticClass:"expense-types"},[t._v("\n                "+t._s(s.subsidyTypeStr)+"\n            ")])])})):t._e()]):t._e()},staticRenderFns:[]}},2175:function(t,s,i){function e(t){i(1690)}var n=i(1)(i(1275),i(2e3),e,null,null);t.exports=n.exports}});